# Sistema de Auditor√≠a con Encriptaci√≥n

Sistema completo de auditor√≠a con encriptaci√≥n a nivel de base de datos para MySQL y PostgreSQL.

## üöÄ Caracter√≠sticas

- ‚úÖ **Auditor√≠a Completa**: Seguimiento autom√°tico de operaciones INSERT, UPDATE y DELETE
- üîí **Encriptaci√≥n a Nivel de DB**: Todos los datos de auditor√≠a se almacenan encriptados
- üéõÔ∏è **Interfaz Web Intuitiva**: Gesti√≥n completa desde una interfaz moderna
- üîë **Gesti√≥n Segura de Claves**: Solo con la clave correcta se pueden desencriptar los datos
- üìä **Soporte Dual**: Compatible con MySQL y PostgreSQL
- ‚ö° **Triggers Autom√°ticos**: Configuraci√≥n autom√°tica de triggers de base de datos
- üìà **Reportes y Estad√≠sticas**: Visualizaci√≥n completa de la actividad de auditor√≠a

## üìÅ Estructura del Proyecto

```
audit-system/
‚îú‚îÄ‚îÄ backend/                 # Servidor Node.js + Express
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config/          # Configuraci√≥n de base de datos
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ controllers/     # Controladores de API
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/        # L√≥gica de negocio
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routes/          # Rutas de la API
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils/           # Utilidades
‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ frontend/                # Aplicaci√≥n React + TypeScript
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/      # Componentes React
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/        # Servicios de API
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ types/           # Definiciones TypeScript
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ hooks/           # Custom hooks
‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îî‚îÄ‚îÄ README.md
```

## üõ†Ô∏è Instalaci√≥n y Configuraci√≥n

### Prerrequisitos

- Node.js 16+ 
- MySQL 5.7+ o PostgreSQL 12+
- npm o yarn

### Backend

```bash
cd backend
npm install

# Configurar variables de entorno
cp .env.example .env

# Iniciar servidor de desarrollo
npm run dev
```

### Frontend

```bash
cd frontend
npm install

# Iniciar aplicaci√≥n React
npm start
```

# Sistema de Auditor√≠a con Encriptaci√≥n

Sistema completo de auditor√≠a con encriptaci√≥n a nivel de base de datos para MySQL y PostgreSQL.

## üöÄ Caracter√≠sticas

- ‚úÖ **Auditor√≠a Completa**: Seguimiento autom√°tico de operaciones INSERT, UPDATE y DELETE
- üîí **Encriptaci√≥n a Nivel de DB**: Todos los datos de auditor√≠a se almacenan encriptados
- üéõÔ∏è **Interfaz Web Intuitiva**: Gesti√≥n completa desde una interfaz moderna
- üîë **Gesti√≥n Segura de Claves**: Solo con la clave correcta se pueden desencriptar los datos
- üìä **Soporte Dual**: Compatible con MySQL y PostgreSQL
- ‚ö° **Triggers Autom√°ticos**: Configuraci√≥n autom√°tica de triggers de base de datos
- üìà **Reportes y Estad√≠sticas**: Visualizaci√≥n completa de la actividad de auditor√≠a

## üìÅ Estructura del Proyecto

```
audit-system/
‚îú‚îÄ‚îÄ backend/                 # Servidor Node.js + Express
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config/          # Configuraci√≥n de base de datos
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ controllers/     # Controladores de API
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/        # L√≥gica de negocio
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routes/          # Rutas de la API
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ utils/           # Utilidades
‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ frontend/                # Aplicaci√≥n React + TypeScript
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/      # Componentes React
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/        # Servicios de API
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ types/           # Definiciones TypeScript
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ hooks/           # Custom hooks
‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îî‚îÄ‚îÄ README.md
```

## üõ†Ô∏è Instalaci√≥n y Configuraci√≥n

### Prerrequisitos

- Node.js 16+ 
- MySQL 5.7+ o PostgreSQL 12+
- npm o yarn

### Backend

```bash
cd backend
npm install

# Configurar variables de entorno (opcional)
PORT=3001
NODE_ENV=development

# Iniciar servidor de desarrollo
npm run dev

# Producci√≥n
npm start
```

### Frontend

```bash
cd frontend
npm install

# Configurar API URL (opcional)
echo "REACT_APP_API_URL=http://localhost:3001/api" > .env

# Iniciar aplicaci√≥n React
npm start
```

## ‚öôÔ∏è Configuraci√≥n de Base de Datos

### MySQL

```sql
-- Crear base de datos de ejemplo
CREATE DATABASE audit_test;

-- Crear usuario con permisos
CREATE USER 'audit_user'@'localhost' IDENTIFIED BY 'password';
GRANT ALL PRIVILEGES ON audit_test.* TO 'audit_user'@'localhost';
FLUSH PRIVILEGES;

-- Tabla de ejemplo
USE audit_test;
CREATE TABLE productos (
    id INT AUTO_INCREMENT PRIMARY KEY,
    nombre VARCHAR(100),
    precio DECIMAL(10,2),
    descripcion TEXT,
    vendido BOOLEAN DEFAULT FALSE
);
```

### PostgreSQL

```sql
-- Crear base de datos de ejemplo
CREATE DATABASE audit_test;

-- Crear usuario con permisos
CREATE USER audit_user WITH PASSWORD 'password';
GRANT ALL PRIVILEGES ON DATABASE audit_test TO audit_user;

-- Conectar a la base de datos y crear tabla de ejemplo
\c audit_test;
CREATE TABLE productos (
    id SERIAL PRIMARY KEY,
    nombre VARCHAR(100),
    precio DECIMAL(10,2),
    descripcion TEXT,
    vendido BOOLEAN DEFAULT FALSE
);

-- Dar permisos al usuario
GRANT ALL PRIVILEGES ON TABLE productos TO audit_user;
GRANT ALL PRIVILEGES ON SEQUENCE productos_id_seq TO audit_user;
```

## üìã Uso del Sistema

### 1. Conectar a Base de Datos

1. Abrir la aplicaci√≥n web en `http://localhost:3000`
2. Seleccionar tipo de base de datos (MySQL/PostgreSQL)
3. Ingresar credenciales de conexi√≥n
4. Probar y conectar

### 2. Configurar Auditor√≠a

**Para una tabla espec√≠fica:**
1. Ir a la pesta√±a "Tablas"
2. Seleccionar tabla y hacer clic en "Configurar Auditor√≠a"
3. Establecer clave de encriptaci√≥n segura
4. Confirmar configuraci√≥n

**Para todas las tablas:**
1. En la pesta√±a "Tablas", hacer clic en "Configurar Todo"
2. Seleccionar tablas a auditar
3. Establecer clave de encriptaci√≥n √∫nica
4. Confirmar configuraci√≥n masiva

### 3. Visualizar Datos de Auditor√≠a

1. Ir a la pesta√±a "Auditor√≠a"
2. Seleccionar tabla de auditor√≠a
3. Hacer clic en "Ver Datos"
4. Los datos aparecer√°n encriptados por defecto
5. Ingresar clave de encriptaci√≥n para desencriptar

## üîê Sistema de Encriptaci√≥n

### Funcionamiento

- **Algoritmo**: AES-256-GCM con PBKDF2
- **Encriptaci√≥n**: A nivel de base de datos, tanto columnas como datos
- **Clave**: Generada por el usuario, no almacenada en el sistema
- **Triggers**: Autom√°ticos para INSERT, UPDATE, DELETE

### Ejemplo de Datos Encriptados

```
Tabla Original: productos
| id | nombre  | precio | descripcion    |
|----|---------|--------|----------------|
| 1  | Laptop  | 2500   | Marca HP       |
| 2  | Mouse   | 25     | Inal√°mbrico    |

Tabla Auditor√≠a Encriptada: aud_productos
| enc_a1b2c3 | enc_d4e5f6        | enc_g7h8i9     | enc_j1k2l3    |
|------------|-------------------|----------------|---------------|
| 9cv8bn2m.. | kj4hg7fd9s1a2b.. | qw3er5ty8ui.. | as2df4gh...   |
```

## üîß API Endpoints

### Base de Datos
- `POST /api/database/test-connection` - Probar conexi√≥n
- `POST /api/database/info` - Informaci√≥n de BD
- `POST /api/database/stats` - Estad√≠sticas

### Tablas
- `POST /api/tables/list` - Listar tablas
- `POST /api/tables/:table/info` - Informaci√≥n de tabla
- `POST /api/tables/:table/triggers` - Triggers de tabla

### Auditor√≠a
- `POST /api/audit/tables` - Tablas de auditor√≠a
- `POST /api/audit/setup/table` - Configurar auditor√≠a individual
- `POST /api/audit/setup/all` - Configurar auditor√≠a masiva
- `POST /api/audit/data/encrypted` - Datos encriptados
- `POST /api/audit/data/decrypted` - Datos desencriptados
- `POST /api/audit/validate-password` - Validar clave
- `POST /api/audit/report` - Generar reporte

## üö¶ Estados del Sistema

### Conexi√≥n a Base de Datos
- ‚úÖ **Conectado**: Sistema operacional
- ‚ùå **Desconectado**: Verificar credenciales
- ‚ö†Ô∏è **Error**: Problema de conexi√≥n

### Estado de Auditor√≠a por Tabla
- ‚úÖ **Con Auditor√≠a**: Tabla auditada y encriptada
- ‚ùå **Sin Auditor√≠a**: Tabla sin configurar
- ‚öôÔ∏è **Configurando**: Proceso en curso

## üìä Funcionalidades Avanzadas

### Reportes de Auditor√≠a
- Filtros por fecha, usuario y tipo de acci√≥n
- Estad√≠sticas de operaciones
- Exportaci√≥n de datos (cuando est√©n desencriptados)

### Verificaci√≥n de Integridad
- Validaci√≥n de datos encriptados
- Detecci√≥n de corrupci√≥n
- Estad√≠sticas de salud del sistema

### Gesti√≥n de Claves
- Generaci√≥n autom√°tica de claves seguras
- Validaci√≥n de fortaleza de contrase√±a
- Sin almacenamiento de claves (seguridad m√°xima)

## üõ°Ô∏è Seguridad

### Mejores Pr√°cticas
1. **Claves Fuertes**: M√≠nimo 8 caracteres, combinar letras, n√∫meros y s√≠mbolos
2. **Backup de Claves**: Guardar claves en lugar seguro y separado
3. **Acceso Limitado**: Solo usuarios autorizados deben tener acceso
4. **Rotaci√≥n**: Cambiar claves peri√≥dicamente en producci√≥n

### Consideraciones
- Las claves no se almacenan en el sistema por seguridad
- Sin la clave correcta, los datos no se pueden recuperar
- Los triggers funcionan autom√°ticamente una vez configurados
- La encriptaci√≥n impacta el rendimiento seg√∫n el volumen de datos

## üêõ Troubleshooting

### Problemas Comunes

**Error de Conexi√≥n:**
```
Error: getaddrinfo ENOTFOUND localhost
```
- Soluci√≥n: Verificar que el servidor de BD est√© ejecut√°ndose
- Verificar host, puerto y credenciales

**Error de Permisos:**
```
Error: Access denied for user
```
- Soluci√≥n: Otorgar permisos CREATE TABLE, CREATE TRIGGER al usuario

**Error de Desencriptaci√≥n:**
```
Error: Contrase√±a de desencriptaci√≥n incorrecta
```
- Soluci√≥n: Verificar que la clave sea exactamente la misma usada al configurar

**Triggers No Funcionan:**
- Verificar permisos de trigger en la BD
- Revisar logs del servidor para errores espec√≠ficos

### Logs del Sistema
```bash
# Backend logs
cd backend
npm run dev

# Frontend logs
cd frontend
npm start
```

## üìù Ejemplo Completo

```javascript
// 1. Conectar a MySQL
const connection = {
  type: 'mysql',
  config: {
    host: 'localhost',
    user: 'audit_user',
    password: 'password',
    database: 'audit_test',
    port: 3306
  }
};

// 2. Configurar auditor√≠a
const auditConfig = {
  tableName: 'productos',
  encryptionKey: 'MiClaveSegura2024!'
};

// 3. Los triggers se crean autom√°ticamente
// INSERT INTO productos VALUES ('Laptop', 2500, 'HP');
// -> Se crea registro encriptado en aud_productos

// 4. Para ver los datos de auditor√≠a
// Usar la interfaz web con la clave 'MiClaveSegura2024!'
```

## ü§ù Contribuci√≥n

1. Fork del repositorio
2. Crear rama feature (`git checkout -b feature/nueva-funcionalidad`)
3. Commit cambios (`git commit -am 'Agregar nueva funcionalidad'`)
4. Push a la rama (`git push origin feature/nueva-funcionalidad`)
5. Crear Pull Request

## üìÑ Licencia

Este proyecto est√° bajo la Licencia MIT - ver el archivo [LICENSE](LICENSE) para detalles.

## üÜò Soporte

Para soporte t√©cnico o preguntas:
- Crear issue en GitHub
- Revisar documentaci√≥n de troubleshooting
- Verificar logs del sistema

---

**Desarrollado con ‚ù§Ô∏è usando Node.js, Express, React y TypeScript**